var basketApi=function(t,n){function e(){h||console.log.apply(console,arguments)}function a(){"/basket/shoppingcart_step3.aspx"!==location.pathname&&(_(),r()),-1!==location.pathname.indexOf("/pi/")&&u(),f()}function r(){s().done(function(t){e(k),"/basket/shoppingcart.aspx"===location.pathname?p(!1):"/basket/shoppingcart_step3.aspx"===location.pathname&&p(!0),m(),b()}).fail(function(t){e("update(): %s",t)})}function s(){var a=t.ajax({cache:!1,url:g.apiUrl,error:function(t){e("read(): %s",t)},success:function(t){}}),r=new t.Deferred;return a.done(function(a){"00000000-0000-0000-0000-000000000000"!==(k=a.data).basketGuid?t.ajax({cache:!1,url:g.apiUrl+"line?include=desc",error:function(t){e("read(): Empty basket"),k.isEmpty=!0,r.resolve()},success:function(a){k.lines=a.data.items,k.isEmpty=!(k.lines.length>0);var s=n.map(a.data.items,function(t){return t.internalItemId1}).join(";"),l=g.jplUrl+"?v=1.0&lId=0&locId="+locId+"&cId="+cId+"&langId="+langId+"&countryId="+contId+"&customerId="+("undefined"!=typeof customerId?customerId:0)+"&pIds="+s;e("read(): %s",l),t.ajax({url:l,error:function(t){e("read(): %s",t),r.resolve()},success:function(t){k.lines.forEach(function(n){t.data.items.forEach(function(t){n.internalItemId1==t.eSellerId&&(n.jpl=t)})}),e(k),r.resolve()}})}}):(k.isEmpty=!0,e("read(): No basket"),k.lines=[])}),r}function l(n,a){var r=[],s={referencingId:n,productType:"product",quantity:a};return r.push(s),t.ajax({type:"POST",contentType:"application/json",dataType:"json",url:g.apiUrl+"line",data:JSON.stringify(r),error:function(t){e(t)},success:function(t){}})}function i(n){return t.ajax({type:"DELETE",contentType:"application/json",dataType:"json",url:g.apiUrl+"line/"+n,error:function(t){e(t)},success:function(t){}})}function o(n,e){var a=[];return a.push({basketLineId:n,quantity:e}),t.ajax({type:"PUT",contentType:"application/json",dataType:"json",url:g.apiUrl+"line",data:JSON.stringify(a),error:function(t){console.log(t)},success:function(t){}})}function c(t,n){var a="";k.lines.forEach(function(r){if(t==r.id){if(void 0!==r.jpl.bundleSize&&r.jpl.bundleSize>1){var s=r.jpl.bundleSize;n%s!=0&&(e("updateItem(): Increased quantity by %i",s-n%s),n+=s-n%s,a=g.labelProductWrongKollie)}r.jpl.inventoryCount<n&&(e("updateItem(): Reducing quantity to match inventoryCount: %i ",n=r.jpl.inventoryCount),a=g.labelProductOutOfStock)}}),o(t,n).done(function(t){e(t),d(""!==a?a:g.labelBasketUpdated),r()}).fail(function(t){e("updateItem(): %s",t)})}function d(n){var e=templates.basketMessage({message:n});t("#ucInfoMessagebdy").remove(),t("#precontentContainer").append(e),t("#ucInfoMessagebdy").fadeIn(g.messageBoxFadeTime),setTimeout(function(){t("#ucInfoMessagebdy").fadeOut(g.messageBoxFadeTime)},g.messageBoxTimer)}function p(n){if(k.isEmpty){e("updateBasket(): Empty basket");a=templates.emptyBasket({});t("#basket").empty().append(a)}else{var a=templates.shoppingCart({onCheckout:n,lines:k.lines,currency:k.lineTotal.currencySymbol,helpers:{formatMoney:v}});t("#basket").empty().append(a),a=templates.shoppingCartTotals({basket:k,currency:k.basketTotal.currencySymbol,helpers:{formatMoney:v}}),t(".basketTotalsBdy").replaceWith(a),a=templates.basketButtons({onCheckout:n}),t(".basketBottomNavBdy").replaceWith(a)}}function u(){t(".addToBasketBtn").attr("onclick",'basketApi.addItem(pId, (isNaN($(".etBasket input").val()) ? 1 : $(".etBasket input").val() ))')}function _(){var n=t(".basketBottomNavBdy").clone();t(n).removeClass("basketBottomNavBdy").addClass("hiddenBasketBottomNavBdy").hide(),t(".basketOuterBdy").append(n)}function m(){t(".basketBottomNavBdy .basketUpdAll").on("click",function(t){e("setupButtonListeners(): %s",y),n.each(n.pairs(y),function(t,n){c(t[0],t[1])}),y={}}),t(".basketBottomNavBdy .basketClrAll").on("click",function(n){t(".hiddenBasketBottomNavBdy .basketClrAll input").click()}),t(".basketBtnDiv .buttonNavNext").on("click",function(n){t(".hiddenBasketBottomNavBdy .basketNxtStep2 input").click()}),t(".basketBottomNavBdy .buttonNavNext").on("click",function(n){t(".hiddenBasketBottomNavBdy .basketNxtStep2 input").click()})}function f(){t(document).on("keyup",function(n){if(t(n.target).hasClass("shoppingCartInput")&&!t(n.target).prop("is:disabled")){if(13==n.keyCode){var e=parseInt(t(n.target).attr("data-lineid")),a=parseFloat(t(n.target).val());return isNaN(a)?(console.log("value is not a number!"),!0):(c(e,a),n.stopPropagation(),!0)}var r=t(n.target),e=parseInt(r.attr("data-lineid")),a=parseFloat(r.val());isNaN(a)||(y[e]=a)}})}function b(){var e=n.reduce(k.lines,function(t,n){return t+n.quantity},0),a=templates.miniBasket({formattedAmount:v(k.basketTotal.priceExVat,k.basketTotal.currencySymbol,!0),productCount:e});t("#miniBasket").empty().html(a),t("#miniBasketMobile .miniBasketItemCount span").text(e)}function v(t,n,e){return void 0!==e&&e?parseFloat(Number(t).toFixed(2)).format(2,3,".",",")+" "+n:n+" "+parseFloat(Number(t).toFixed(2)).format(2,3,".",",")}var k={},y={},h=!0,g={jplUrl:"/Services/ProductService.asmx/Products",apiUrl:"/sessionservices/v2/basket/current/",messageBoxTimer:3e3,messageBoxFadeTime:500,labelProductOutOfStock:"Antal har ändrats för att passa lagermängd",labelProductWrongKollie:"Antal har ändrats för att passa kollistorleken",labelBasketUpdated:"Din varukorg är uppdaterad."};return t(document).ready(function(){a()}),{addItem:function(t,n){l(t,n).done(function(t){var n=t&&t.data&&t.data.items&&t.data.items[0].messages&&t.data.items[0].messages[0]&&t.data.items[0].messages[0].message;n&&d(n),r()}).fail(function(t){e("addItem(): %s",t)})},deleteItem:function(t){i(t).done(function(t){e(t),d(g.labelBasketUpdated),r()}).fail(function(t){e("deleteItem(): %s",t)})}}}($,_);Number.prototype.format=function(t,n,e,a){var r="\\d(?=(\\d{"+(n||3)+"})+"+(t>0?"\\D":"$")+")",s=this.toFixed(Math.max(0,~~t));return(a?s.replace(".",a):s).replace(new RegExp(r,"g"),"$&"+(e||","))};var templates=templates||{};$.extend(templates,{basketButtons:function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",onCheckout?__p+='\r\n  <div class="clearfix">\r\n\r\n  </div>\r\n  <a class="basketNxtStep2">\r\n    <span class="buttonNavNext">\r\n      Kassan\r\n      \x3c!-- Gå til betaling --\x3e\r\n    </span>\r\n  </a>\r\n':__p+='\r\n  <div class="basketBottomNavBdy clearfix">\r\n    <a class="basketNxtStep2 right">\r\n      <span class="buttonNavNext">\r\n      \tKassan\r\n\t      \x3c!-- Gå til kassen --\x3e\r\n      </span>\r\n    </a>\r\n    <a class="basketUpdAll right">\r\n      <span class="buttonUpdateBasket">\r\n        Uppdatera innehållet\r\n        \x3c!-- Opdater indhold --\x3e\r\n      </span>\r\n    </a>\r\n    <a class="basketClrAll right">\r\n      <span class="buttonClearBasket">\r\n        Töm varukorg\r\n        \x3c!-- Tøm kurven --\x3e\r\n      </span>\r\n    </a>\r\n  </div>\r\n',__p+="\r\n";return __p}});var templates=templates||{};$.extend(templates,{basketMessage:function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div id="ucInfoMessagebdy" class="esebdy" style="margin-left: -273.5px;">\r\n\t<i class="fa fa-close"></i>\r\n\t<div class="notAddedToBasket">\r\n\t\t'+(null==(__t=message)?"":__t)+"\r\n\t</div>\r\n</div>";return __p}});var templates=templates||{};$.extend(templates,{emptyBasket:function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="basketIsEmptyBdy">\r\n\t<h1>\r\n\t\tKundvagnen är tom!\r\n\t</h1><br>\r\n\t<a href="/" class="buttonNavPrev">\r\n\t\tFortsätt handla\r\n\t</a>\r\n</div>';return __p}});var templates=templates||{};$.extend(templates,{miniBasket:function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a href="/basket/shoppingcart.aspx" class="show-for-medium-up show-for-large-up">\r\n\t<div class="basketCartImg">\r\n\t\t<img src="/media/349/img/basketCart.png">\r\n\t\t<span class="miniBasketItemCount">\r\n\t\t\t'+(null==(__t=productCount)?"":__t)+'\r\n\t\t</span>\r\n\t</div>\r\n\t<span class="miniBasketText">\r\n\t\t'+(null==(__t=formattedAmount)?"":__t)+"\r\n\t</span>\r\n</a>\r\n";return __p}});var templates=templates||{};$.extend(templates,{shoppingCart:function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",onCheckout||(__p+='\r\n<div class="basketTopNavBdy">\r\n    <div class="basketHeader">\r\n        <h1>\r\n          Korg\r\n          \x3c!-- Indkøbskurv --\x3e\r\n        </h1>\r\n    </div>\r\n    <div class="basketBtnDiv clearfix">\r\n        <div class="basketPreStep left">\r\n            <a class="buttonNavPrev" href="/">\r\n              Fortsätt handla\r\n              \x3c!-- shop videre --\x3e\r\n            </a>\r\n        </div>\r\n        <div class="basketNxtStep right">\r\n            <a class="buttonNavNext">\r\n              Kassan\r\n              \x3c!-- Gå til kassen --\x3e\r\n            </a>\r\n        </div>\r\n    </div>\r\n</div>\r\n'),__p+="\r\n\r\n",onCheckout&&(__p+='\r\n<div class="orderDetails">\r\n  <div class="header_bullet">\r\n    <span>5</span>\r\n  </div>\r\n  <div class="checkoutHeadersLabel">\r\n    <h2>\r\n      Tjek din ordre\r\n      \x3c!-- Tjek din ordre --\x3e\r\n    </h2>\r\n  </div>\r\n</div>\r\n'),__p+='\r\n\r\n<div class="basketDetailsBdy">\r\n    <div id="ec32">\r\n      <table class=\'HeaderBarTables ec32Table\'>\r\n        <tbody>\r\n          <tr class="HeaderBar ec32Head">\r\n            <td class="HeaderBar c1">Bild</td>\r\n            <td class="HeaderBar c3">Varenr.</td>\r\n            <td class="HeaderBar c4">Beskrivning</td>\r\n            <td class="HeaderBar c5">Antal</td>\r\n            <td class="HeaderBar c6">Pris</td>\r\n            <td class="HeaderBar c7">Rabatt</td>\r\n            <td class="HeaderBar c8">Pris</td>\r\n            ',onCheckout||(__p+='\r\n              <td class="HeaderBar c9">Radera</td>\r\n            '),__p+="\r\n          </tr>\r\n          ",_.each(lines,function(t,n){__p+='\r\n            <tr class="row '+(null==(__t=n%2!=0?"rowOdd":"rowEven")?"":__t)+'" >\r\n              <td class="content c1">\r\n                <a href=\''+(null==(__t=t.itemUrl)?"":__t)+"'>\r\n                \t";var e=t.jpl&&t.jpl.images&&t.jpl.images[0]&&t.jpl.images[0].url;__p+="\r\n                  <img src='"+(null==(__t=e)?"":__t)+'\' style="display:inline-block;height:60px !important;">\r\n                </a>\r\n              </td>\r\n              <td class="content c3">\r\n                <a href=\''+(null==(__t=t.itemUrl)?"":__t)+"'>\r\n                  "+(null==(__t=t.externalItemId1)?"":__t)+'\r\n                </a>\r\n              </td>\r\n              <td class="content c4">\r\n                <a href=\''+(null==(__t=t.itemUrl)?"":__t)+"'>\r\n                  "+(null==(__t=t.description1)?"":__t)+'\r\n                </a>\r\n              </td>\r\n              <td class="content c5">\r\n                ',onCheckout?__p+="\r\n                  <span>\r\n                    "+(null==(__t=t.quantity)?"":__t)+"\r\n                  </span>\r\n                ":(__p+="\r\n                  <input class='shoppingCartInput' type='text' name='name' value='"+(null==(__t=t.quantity)?"":__t)+"' data-lineid='"+(null==(__t=t.id)?"":__t)+"' data-bundlesize='"+(null==(__t=t.jpl.bundleSize)?"":__t)+'\' >\r\n                  <div class="shoppingCartInputContainer">\r\n                    ',t.jpl&&t.jpl.bundleSize>0&&(__p+='\r\n                      <div class="product-basket-crs-controls">\r\n                        <div class="product-basket-crs-add">\r\n                          <i class="zmdi zmdi-caret-up"></i>\r\n                        </div>\r\n                        <div class="product-basket-crs-sub">\r\n                          <i class="zmdi zmdi-caret-down"></i>\r\n                        </div>\r\n                      </div>\r\n                    '),__p+="\r\n                  </div>\r\n                "),__p+="\r\n                \x3c!-- "+(null==(__t=t.userCode3)?"":__t)+' --\x3e\r\n              </td>\r\n              <td class="content c6">\r\n                <a href=\''+(null==(__t=t.itemUrl)?"":__t)+"'>\r\n                  "+(null==(__t=helpers.formatMoney(t.unitPrice.priceIncVat,currency))?"":__t)+'\r\n                </a>\r\n              </td>\r\n              <td class="content c7">\r\n                '+(null==(__t=t.jpl.salesPrices.length>0&&0!==t.jpl.salesPrices[0].lineDiscountPercentage?t.jpl.salesPrices[0].lineDiscountPercentageFormatted+" %":"")?"":__t)+'\r\n              </td>\r\n              <td class="content c8">\r\n                '+(null==(__t=helpers.formatMoney(t.lineAmount.priceIncVat,currency))?"":__t)+"\r\n              </td>\r\n              ",onCheckout||(__p+='\r\n              <td class="content c9">\r\n              \t',"Coupon"!==t.itemContent?__p+='\r\n\t                <img src="/SL/SI/836/50/f36e3098-5799-4978-95cc-1c7ed0df3f0a.png"\r\n\t                  alt="Delete item" style="display:inline-block;height:22px;width:22px;" onclick="basketApi.deleteItem( '+(null==(__t=t.id)?"":__t)+' )"/>\r\n              \t':__p+=' \r\n              \t\t<a href="/basket/shoppingcart.aspx?ce32cmd=remove&ce32lid='+(null==(__t=t.id)?"":__t)+'">\r\n              \t\t\t<img src="/SL/SI/836/50/f36e3098-5799-4978-95cc-1c7ed0df3f0a.png"\r\n\t                  alt="Delete item" style="display:inline-block;height:22px;width:22px;"/>\r\n              \t\t</a>\r\n              \t',__p+="\r\n              </td>\r\n              "),__p+="\r\n            </tr>\r\n            "}),__p+="\r\n          </tbody>\r\n        </table>\r\n\r\n    </div>\r\n</div>\r\n";return __p}});var templates=templates||{};$.extend(templates,{shoppingCartTotals:function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="basketTotalsBdy right clearfix">\r\n\t<div id="ec38">\r\n\t  <table class="ec38TableTotals">\r\n\t    <tbody>\r\n\t      <tr class="ec38Subtotal">\r\n\t        <td class="content c1">\r\n\t          Delsumma\r\n\t          \x3c!-- Subtotal --\x3e\r\n\t        </td>\r\n\t        <td class="content c2">\r\n\t          <span>'+(null==(__t=helpers.formatMoney(basket.lineTotal.priceExVat,currency))?"":__t)+"</span>\r\n\t        </td>\r\n\t      </tr>\r\n\t      ",_.each(basket.fees,function(t){__p+="\r\n\t        ",0!=t.fee.priceExVat&&(__p+='\r\n\t          <tr class="ec38Shipment">\r\n\t            <td class="content c1">\r\n\t              '+(null==(__t=t.name)?"":__t)+" - "+(null==(__t=t.description)?"":__t)+'\r\n\t            </td>\r\n\t            <td class="content c2">\r\n\t              '+(null==(__t=helpers.formatMoney(t.fee.priceExVat,currency))?"":__t)+"\r\n\t            </td>\r\n\t          </tr>\r\n\t        "),__p+="\r\n\t      "}),__p+='\r\n\t      <tr class="ec38Tax">\r\n\t        <td class="content c1">\r\n\t          Moms\r\n\t          \x3c!-- heraf moms --\x3e\r\n\t        </td>\r\n\t        <td class="content c2">\r\n\t          '+(null==(__t=helpers.formatMoney(basket.basketTotal.vatAmount,currency))?"":__t)+'\r\n\t        </td>\r\n\t      </tr>\r\n\t      <tr class="HeaderBar ec38Total">\r\n\t        <td class="content c1">\r\n\t          Totalt\r\n\t          \x3c!-- Total --\x3e\r\n\t        </td>\r\n\t        <td class="content c2">\r\n\t          '+(null==(__t=helpers.formatMoney(basket.basketTotal.priceIncVat,currency))?"":__t)+'\r\n\t        </td>\r\n\t      </tr>\r\n\t    </tbody>\r\n\t  </table>\r\n\t  <div class="content">* Momsfri</div>\r\n\t</div>\r\n\t\r\n</div>\r\n';return __p}});